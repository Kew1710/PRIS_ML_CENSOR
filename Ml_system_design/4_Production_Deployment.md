# Деплой

## Диаграмма общей архитектуры

**Компоненты архитектуры:**
- **Frontend / CMS** — источник комментариев
- **Gateway API** — централизованная точка входа, шифрует и маршрутизирует запросы
- **Message Queue** — буферизует поток комментариев
- **Classifier Service (ML API)** — сервис, реализующий модель тональности
- **Moderation Service** — обрабатывает результаты классификации, эскалирует флаги
- **Manual Review Panel** — интерфейс для модераторов
- **Data Store** — хранение исходных и размеченных комментариев

## Инфраструктура и масштабируемость

### Оркестрация:
- **Kubernetes**:
  - Горизонтальное масштабирование
  - Авто-рестарт при сбоях
  - Blue/Green deployment для обновлений модели

### Хранилище:
- **Object storage (S3)** — хранение логов, обучающих выборок, моделей
- **NoSQL (MongoDB)** — для хранения токенизированных комментариев и результатов
- **PostgreSQL** — аналитика, дашборды модерации

### Очереди:
- **Kafka** или **RabbitMQ**:
  - Очередь поступающих комментариев
  - Партиционирование по тематикам/языкам/каналам

## SLA и параметры

| Показатель         | Значение                  |
|--------------------|---------------------------|
| RPS                | 1000–5000 req/sec         |
| Latency (p95)      | ≤ 100 мс                  |
| Обработка очереди  | ≥ 50,000 комментариев/мин |
| Uptime             | ≥ 99.5%                   |

### Failover
- Обработка фолбэками
- Логирование инцидентов

## Риски и планы отката

### Возможные риски:
1. **Непредсказуемое поведение модели:**
   - Изменение тональности на новых инфоповодах
   - Всплытие токсичных паттернов, не распознанных в обучении

2. **Сбой или перегрузка ML-сервиса:**
   - Потеря сообщений в очереди
   - Увеличение задержек (latency > 500 мс)

3. **Ошибочные флаги / блокировки:**
   - Репутационные и юридические риски
   - Жалобы от пользователей

### План отката:
- Хранение последних двух стабильных моделей в S3 → быстрый rollback через CI/CD
- Механизм включения/отключения классификатора
- A/B сравнение версий модели на канареечном трафике
- Ведение логов всех решений модели для аудита

[Главная страница](../README.md)
